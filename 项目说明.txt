2025-11-25T18:07:09+08:00
git地址:https://github.com/fuscn/kincount.git
前端为vue3+vant4,后端为thinkphp8
所有涉及商品选择、库存展示、单据明细的地方，都必须从“商品级”升级为“SKU级”。
能使用pinia状态管理的地方一律使用状态管理
账款往来金额一律使用正数表示,不要使用负数


业务全景流程
├─ 1. 订单业务流
│   ├─ 1.1 采购订单流
│   │   ├─ 开始 → 创建采购订单(前端操作) → 状态:待审核(1)
│   │   │   ├─ 审核通过(前端操作) → 状态:已审核(2)
│   │   │   │   ├─ 创建采购入库单(前端操作) → 审核通过(前端操作) → 更新库存↑(后端自动) → 生成应付账款(后端自动)
│   │   │   │   │   ├─ 全部入库 → 状态:已完成(4) → 账款核销
│   │   │   │   │   └─ 部分入库 → 状态:部分入库(3) → 继续入库
│   │   │   │   └─ [退货分支] 采购退货(前端操作) → 审核(前端操作) → 退货出库(前端操作) → 库存↓(后端自动) → 应收退款(后端自动)
│   │   │   └─ 审核不通过(前端操作) → 状态:已取消(5)
│   │   └─ 结束
│   │
│   └─ 1.2 销售订单流
│       ├─ 开始 → 创建销售订单(前端操作) → 状态:待审核(1)
│       │   ├─ 审核通过(前端操作) → 状态:已审核(2)
│       │   │   ├─ 创建销售出库单(前端操作) → 审核通过(前端操作) → 更新库存↓(后端自动) → 生成应收账款(后端自动)
│       │   │   │   ├─ 全部出库 → 状态:已完成(4) → 账款核销
│       │   │   │   └─ 部分出库 → 状态:部分出库(3) → 继续出库
│       │   │   └─ [退货分支] 销售退货(前端操作) → 审核(前端操作) → 退货入库(前端操作) → 库存↑(后端自动) → 应付退款(后端自动)
│       │   └─ 审核不通过(前端操作) → 状态:已取消(5)
│       └─ 结束
│
├─ 2. 账款核销流
│   ├─ 支付时自动核销流程（从应付/应收页面）
│   │   ├─ 账款记录 → 支付操作(前端输入:金额、方式) → 后端自动处理:
│   │   │   ├─ 创建财务收支记录(后端自动)
│   │   │   ├─ 创建账款核销记录(后端自动)
│   │   │   ├─ 更新账款余额(后端自动)
│   │   │   │   ├─ 检查结清状态(后端自动)
│   │   │   │   │   ├─ 已结清 → 状态:已结清(2)
│   │   │   │   │   └─ 未结清 → 状态:未结清(1)
│   │   │   └─ 更新供应商/客户余额(后端自动)
│   │   └─ 结束
│
├─ 3. 库存管理流（并行）
│   ├─ 3.1 盘点流程
│   │   ├─ 创建盘点单(前端操作) → 状态:盘点中(1)
│   │   │   ├─ 完成盘点(前端操作) → 状态:已完成(2) → 库存调整(后端自动)
│   │   │   └─ 取消盘点(前端操作) → 状态:已取消(3)
│   │   └─ 结束
│   │
│   └─ 3.2 调拨流程
│       ├─ 创建调拨单(前端操作) → 状态:待调拨(1)
│       │   ├─ 开始调拨(前端操作) → 状态:调拨中(2)
│       │   │   ├─ 扣减源仓库库存(后端自动)
│       │   │   ├─ 增加目标仓库库存(后端自动)
│       │   │   └─ 完成调拨(前端操作) → 状态:已完成(3)
│       │   └─ 取消调拨(前端操作) → 状态:已取消(4)
│       └─ 结束
│
└─ 4. 预警监控流（后台）
    ├─ 实时监控库存(后端定时任务) → 检查预警规则(后端自动)
    │   ├─ 低于最低库存 → 生成采购建议(后端自动)
    │   └─ 高于最高库存 → 生成促销建议(后端自动)
    └─ 循环监控(后端持续)    